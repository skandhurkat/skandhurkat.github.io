<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.2.5">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Skand Hurkat">

  
  
  
    
  
  <meta name="description" content="CMake is cross-platform build and configuration system for C and C&#43;&#43; code, which also happens to be my favourite build system. In this post, I&rsquo;ll present a quick tutorial on getting started with CMake.
But before we do, let&rsquo;s start with an example of why other build systems such as Makefiles don&rsquo;t necessarily cut it. Actually, Makefiles work fairly well, but writing Makefiles by hand is generally a pain in the neck.">

  
  <link rel="alternate" hreflang="en-us" href="https://skandhurkat.com/post/intro-to-cmake/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  
    
    
    
    
      
    
    
    
    <link rel="stylesheet" href="/css/academic.51da33ec68a1f05336705858a797eac3.css">
  

  
  
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-10EYG9FSV9"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-10EYG9FSV9', { 'anonymize_ip': false });
}
</script>

  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://skandhurkat.com/post/intro-to-cmake/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@skandhurkat">
  <meta property="twitter:creator" content="@skandhurkat">
  
  <meta property="og:site_name" content="Skand Hurkat">
  <meta property="og:url" content="https://skandhurkat.com/post/intro-to-cmake/">
  <meta property="og:title" content="Introduction to CMake | Skand Hurkat">
  <meta property="og:description" content="CMake is cross-platform build and configuration system for C and C&#43;&#43; code, which also happens to be my favourite build system. In this post, I&rsquo;ll present a quick tutorial on getting started with CMake.
But before we do, let&rsquo;s start with an example of why other build systems such as Makefiles don&rsquo;t necessarily cut it. Actually, Makefiles work fairly well, but writing Makefiles by hand is generally a pain in the neck."><meta property="og:image" content="https://skandhurkat.com/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2017-11-23T16:28:40-05:00">
  
  <meta property="article:modified_time" content="2017-11-23T16:28:40-05:00">
  

  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#2962ff",
          "text": "#fff"
        },
        "button": {
          "background": "#fff",
          "text": "#2962ff"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>


  

  <title>Introduction to CMake | Skand Hurkat</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Skand Hurkat</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#experience">
            
            <span>Experience</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Introduction to CMake</h1>

  

  
    



<meta content="2017-11-23 16:28:40 -0500 -0500" itemprop="datePublished">
<meta content="2017-11-23 16:28:40 -0500 -0500" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Thursday, 23 November, 2017</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="/post/intro-to-cmake/#disqus_thread"></a>
  

  

  
    

  

</div>

    








  









  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <p><a href="//cmake.org">CMake</a> is cross-platform build and configuration system
for C and C++ code, which also happens to be my favourite build system.
In this post, I&rsquo;ll present a quick tutorial on getting started with
CMake.</p>
<p>But before we do, let&rsquo;s start with an example of why other build systems
such as Makefiles don&rsquo;t necessarily cut it. Actually, Makefiles work
fairly well, but writing Makefiles by hand is generally a pain in the
neck. In <a href="https://skandhurkat.com/post/makefile-dependencies/">a previous post</a>,
I described how to write Makefiles that take include file dependencies
into account. If that post did not convince you that writing Makefiles
is hard, let me show you another example of a terrible Makefile and hope
that it scares you into never looking at a Makefile again. (This
Makefile was actually part of a project that was handed over to me, I
had to go over tonnes of other people&rsquo;s code with comments written in
non-ascii characters in a language that wasn&rsquo;t English, so I clearly
don&rsquo;t have fond memories of this particular project.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Makefile" data-lang="Makefile"><span style="display:flex;"><span><span style="color:#75715e">## Compiler + Linker
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CC <span style="color:#f92672">=</span> g++
</span></span><span style="display:flex;"><span>LD <span style="color:#f92672">=</span> g++
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## external .h files to bring in
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>EXTRA_INCLUDES <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>CCFLAGS <span style="color:#f92672">=</span> -g -Wno-deprecated -I/opt/local/include/ -I/opt/local/include/opencv/ -I./GMM/ -I./MaxFlow/ -I./MeanShift/ 
</span></span><span style="display:flex;"><span>LDFLAGS <span style="color:#f92672">=</span> -L/opt/local/lib
</span></span><span style="display:flex;"><span><span style="color:#75715e">#LIBS = -lcv -lcxcore -lhighgui -lcvaux #-lml 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># for macs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>LIBS <span style="color:#f92672">=</span> -lopencv_core -lopencv_highgui <span style="color:#75715e">#-lcvaux -lml </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## sources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CCFILES_GMM <span style="color:#f92672">=</span> <span style="color:#75715e">#### Some files</span>
</span></span><span style="display:flex;"><span>CCFILES_MAXFLOW <span style="color:#f92672">=</span> <span style="color:#75715e">#### Some more files</span>
</span></span><span style="display:flex;"><span>CCFILES_MEANSHIFT <span style="color:#f92672">=</span> <span style="color:#75715e">#### Holy shit, even more files</span>
</span></span><span style="display:flex;"><span>CCFILES <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>CCFILES_GMM<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>CCFILES_MAXFLOW<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>CCFILES_MEANSHIFT<span style="color:#66d9ef">)</span> <span style="color:#75715e">#### And even more files</span>
</span></span><span style="display:flex;"><span>PROGFILE <span style="color:#f92672">=</span> main.cpp <span style="color:#75715e">#### Seriously, how many files?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## object compilation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>PROGOBJS <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>CCFILES:.cpp<span style="color:#f92672">=</span>.o<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>PROGFILE:.cpp<span style="color:#f92672">=</span>.o<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## binary compilation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>PROG <span style="color:#f92672">=</span> BOO
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">all</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;-&gt; Building </span><span style="color:#66d9ef">$(</span>PROG<span style="color:#66d9ef">)</span><span style="color:#e6db74"> executable...&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#	@make .cpp.o
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	@make <span style="color:#66d9ef">$(</span>PROG<span style="color:#66d9ef">)</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">.cpp.o</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>CCFLAGS<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>EXTRA_INCLUDES<span style="color:#66d9ef">)</span> -c -o $@ $^
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#$(PROGOBJS):
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	$(CC) $(CCFLAGS) $(EXTRA_INCLUDES) -c -o $@ $^
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$(PROG)</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>PROGOBJS<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>LD<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>LDFLAGS<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>LIBS<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>PROGOBJS<span style="color:#66d9ef">)</span> -o <span style="color:#66d9ef">$(</span>PROG<span style="color:#66d9ef">)</span> <span style="color:#75715e">#$(PROGOBJS) $(LDFLAGS) $(LIBS)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#$(PROG): $(CCFILES)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	$(CC) $(CCFLAGS) $(EXTRA_INCLUDES) $(LDFLAGS) $(LIBS) -o $@ $^
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;-&gt; Cleaning...&#34;</span>
</span></span><span style="display:flex;"><span>	rm -f <span style="color:#66d9ef">$(</span>PROG<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>PROGOBJS<span style="color:#66d9ef">)</span> 
</span></span></code></pre></div><p>There&rsquo;s just so much to hate about this Makefile. First, it is almost
unreadable. Second, it does not account for any header file
dependencies. In fact, if any of the header files change, there&rsquo;s no way
for the system to detect this at all, forcing the user to type in <code>make clean</code>, then <code>make</code> to make everything all over again. Third, given the
sheer number of files, make will take minutes to run, which kills
productivity. Fourth, if you look closely at the path, you will observe
that the person writing this Makefile used a Mac with MacPorts and
therefore is the kind of person who is just wrong. Fifth, this Makefile
obviously won&rsquo;t work for someone on Linux or Windows, even worse, it
won&rsquo;t work for another Mac user who used HomeBrew or compiled OpenCV
from source. Sixth, some rules are just commented out, which indicates
sloppy behaviour. Writing Makefiles like this just sucks. It sucks
productivity and makes me think of slow and painful death.</p>
<p>The first thing I did when I was handed this project was to fix the
build system, and CMake came to the rescue here. I&rsquo;ll now show how I
replaced this terrible Makefile with a clean, modular CMake build system
that replicated the effects of the Makefile (without the bugs, of course
😄). Hopefully, the ease of setting up this CMake system will
convince you to never write a Makefile again.</p>
<p>As a dive into CMake, let&rsquo;s start with a simple &lsquo;Hello World&rsquo; program.
The <code>helloworld.cc</code> file contains the following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Hello World&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>To compile this code, create a file called <code>CMakeLists.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-CMake" data-lang="CMake"><span style="display:flex;"><span>add_executable(<span style="color:#e6db74">hello</span> <span style="color:#e6db74">helloworld.cc</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Now, assuming that you are running on Linux or Mac OS terminal
(something with bash), you can execute the following commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir build;
</span></span><span style="display:flex;"><span>cd build;
</span></span><span style="display:flex;"><span>cmake ..;
</span></span><span style="display:flex;"><span>make;
</span></span></code></pre></div><p>This code creates a directory called build inside the project directory.
(An important point to note is that CMake always builds &lsquo;out of source&rsquo;,
i.e. the build directory must be a distinct directory from the source
directory.) It then switches to the build directory, executes CMake,
which creates Makefiles (turns out that there is no escaping Makefiles
after all&hellip; 😁) that have all the necessary information. As these
files are generated by a tool and not written by a person, you never
have to read them, so Makefile readability is not a concern.  Second,
the Makefiles encode all the dependencies correctly, so there&rsquo;s no
reason to go through the hoops creating complex dependency files.</p>
<p>&lsquo;But what if I&rsquo;m on Windows, or if I just am the kind of person who is
always wrong and uses CodeBlocks, Xcode, or another IDE?&rsquo; you ask. Well,
hold on till the end, I&rsquo;ll show you how CMake has you covered.</p>
<p>Anyway, back to our hypothetical, but totally real project. The project
has multiple source files in different directories.</p>
<dl>
<dt>GMM</dt>
<dd>contains files that implement a Gaussian mixture models code.</dd>
<dt>MAXFLOW</dt>
<dd>contains files for max-flow graph cuts.</dd>
<dt>MEANSHIFT</dt>
<dd>contains files for mean shift (cluster analysis).</dd>
</dl>
<p>All these codes are independent, so could be made into libraries. Of
course, actually packaging this code as independent libraries is a
terrible idea because the code isn&rsquo;t well written in the first place.
However, I don&rsquo;t see too much harm in creating a static library that
will probably never be distributed for code in each of these
directories.</p>
<p>We can create a <code>CMakeLists.txt</code> file for each of these folders. The
CMakeLists will contain code that looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-CMake" data-lang="CMake"><span style="display:flex;"><span>add_library(<span style="color:#75715e"># Library name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#e6db74">STATIC</span> <span style="color:#75715e"># Need to create a static library, not a shared one.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">### List of files
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Then the top-level CMakeLists.txt can include these directories through
the simple command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-CMake" data-lang="CMake"><span style="display:flex;"><span><span style="color:#75715e"># Tell CMake to look into subdirectories for CMakeLists.txt files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>subdirs(<span style="color:#e6db74">GMM</span> <span style="color:#e6db74">MAXFLOW</span> <span style="color:#e6db74">MEANSHIFT</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Add these directories to the compiler search path for include files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># ${PROJECT_SOURCE_DIR} is the path to the source code in the project.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>include_directories(
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/GMM</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/MAXFLOW</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/MEANSHIFT</span>
</span></span><span style="display:flex;"><span>	)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Okay, but we also notice that the top-level program <code>PROG</code> needs OpenCV
in order to compile. CMake provides a very easy method to search for
dependencies. In the top-level <code>CMakeLists.txt</code>, we add</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-CMake" data-lang="CMake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">OpenCV</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>When we compile the program <code>PROG</code>, we need to link it against the
OpenCV libraries, as well as the static libraries in the GMM, MAXFLOW,
MEANSHIFT folders.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-CMake" data-lang="CMake"><span style="display:flex;"><span>include_directories(<span style="color:#f92672">${</span>OpenCV_INCLUDE_DIRS<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>add_executable(<span style="color:#e6db74">PROG</span> <span style="color:#e6db74">PROG.cc</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries(<span style="color:#e6db74">PROG</span> <span style="color:#f92672">${</span>OpenCV_LIBS<span style="color:#f92672">}</span> <span style="color:#e6db74">GMM</span> <span style="color:#e6db74">MAXFLOW</span> <span style="color:#e6db74">MEANSHIFT</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Putting it all together, the top-level <code>CMakeLists.txt</code> contains the
following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-CMake" data-lang="CMake"><span style="display:flex;"><span><span style="color:#75715e"># Set a minimum version of CMake to be used, depending on the syntax of
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># the CMakeLists files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>cmake_minimum_required(<span style="color:#e6db74">VERSION</span> <span style="color:#e6db74">2</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Give this project a cutsie name.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>project(<span style="color:#e6db74">PROG</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># CMake subdirectories to include for these libraries.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>subdirs(<span style="color:#e6db74">GMM</span> <span style="color:#e6db74">MAXFLOW</span> <span style="color:#e6db74">MEANSHIFT</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Search for OpenCV. If OpenCV is found, the command sets the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># ${OpenCV_INCLUDE_DIR} and ${OpenCV_LIBS} variables to appropriate
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># values. If OpenCV is not found, CMake will fail.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>find_package(<span style="color:#e6db74">OpenCV</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Tell the compiler to search these directories for include files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>include_directories(
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/GMM</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/MAXFLOW</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/MEANSHIFT</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">${</span>OpenCV_INCLUDE_DIR<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>	)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Finally, create the executable that we want.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>add_executable(<span style="color:#e6db74">PROG</span> <span style="color:#e6db74">PROG.cc</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># And link it against the required libraries.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>target_link_libraries(<span style="color:#e6db74">prog</span> <span style="color:#f92672">${</span>OpenCV_LIBS<span style="color:#f92672">}</span> <span style="color:#e6db74">GMM</span> <span style="color:#e6db74">MAXFLOW</span> <span style="color:#e6db74">MEANSHIFT</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>And we&rsquo;re done! Isn&rsquo;t this CMakeLists.txt file so much more readable
than the Makefile shown earlier? Not just that, this system will work
with any OS, any compiler, any platform. Isn&rsquo;t this great?</p>
<p>Okay, okay, you&rsquo;re the kind that likes to do things in an IDE. CMake has
a concept of
&lsquo;<a href="//cmake.org/cmake/help/v3.0/manual/cmake-generators.7.html">generators</a>&rsquo;,
which is just a fancy name for a backend. Still assuming that we are on
MacOS or Linux, we simply execute the following commands.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir build;
</span></span><span style="display:flex;"><span>cd build;
</span></span><span style="display:flex;"><span>cmake -G <span style="color:#e6db74">&#34;Xcode&#34;</span> .. <span style="color:#75715e"># Or CodeBlocks, or whatever.</span>
</span></span></code></pre></div><p>On Windows, execute the following commands on the command prompt
(assuming that CMake is on your path) to create a Visual Studio 2015
project.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>md build
</span></span><span style="display:flex;"><span>cd build
</span></span><span style="display:flex;"><span>cmake -G <span style="color:#e6db74">&#34;Visual Studio 14&#34;</span> ..
</span></span></code></pre></div><p>Oh, did I mention that CMake also has a nice GUI that makes this entire
process super easy? I won&rsquo;t describe it here, I&rsquo;ll just let you try it
out for yourself.</p>
<p>The utility of CMake, however, doesn&rsquo;t just end here. CMake has a very
neat testing system called CTest, which is something that I have
mentioned in <a href="https://skandhurkat.com/post/intro-to-ctest/">an earlier post</a>.
This testing system interacts perfectly with a dashboard system called
CDash, that can quickly allow people to view test results. CTest/CDash
also has support for testing memory leaks and code coverage, so there.
Finally, the last piece of the puzzle is CPack, which is a way of
packaging software into installers.</p>
<p>The next post in the series will probably deal with advanced CMake
configuration, including testing compiler versions, creating release and
debug configurations. Until next time&hellip;</p>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/cmake/">cmake</a>
  
  <a class="badge badge-light" href="/tags/programming/">programming</a>
  
</div>




    
      






  







      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/post/intro-to-ctest/">An Introduction to CTest</a></li>
          
          <li><a href="/post/why-i-like-cpp11/">On writing platform-independent code (or why I like the new C&#43;&#43;)</a></li>
          
          <li><a href="/post/autohell-v-cmake/">AutoHell v CMake</a></li>
          
          <li><a href="/post/makefile-dependencies/">Handling dependencies in Makefiles</a></li>
          
          <li><a href="/post/gcc-constructor-bug/">A bug in how GCC handles constructors</a></li>
          
        </ul>
      </div>
      
    

    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "skandhurkat-csl" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>



    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
    

    
    

    
    
    
    <script id="dsq-count-scr" src="//skandhurkat-csl.disqus.com/count.js" async></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.42c4a5b12edc1e28e3c1ed0cb89c7ed9.js"></script>

  </body>
</html>

